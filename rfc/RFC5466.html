<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head profile="http://dublincore.org/documents/2008/08/04/dc-html/"> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta name="robots" content="index,follow" /> 
  <meta name="creator" content="rfcmarkup version 1.127" /> 
  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" /> 
  <meta name="DC.Identifier" content="urn:ietf:rfc:5466" /> 
  <meta name="DC.Description.Abstract" content="The document defines a way to persistently store named IMAP (RFC 3501)
searches on the server. Such named searches can be subsequently
referenced in a SEARCH or any other command that accepts a search
criterion as a parameter." /> 
  <meta name="DC.Creator" content="Melnikov, Alexey" /> 
  <meta name="DC.Creator" content="King, Curtis" /> 
  <meta name="DC.Date.Issued" content="February, 2009" /> 
  <meta name="DC.Title" content="IMAP4 Extension for Named Searches (Filters)" /> 
  <link rel="icon" href="/images/rfc.png" type="image/png" /> 
  <link rel="shortcut icon" href="/images/rfc.png" type="image/png" /> 
  <title>RFC 5466 - IMAP4 Extension for Named Searches (Filters)</title> 
  <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style> 
  <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]--> 
  <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script> 
 </head> 
 <body onload="addHeaderTags()"> 
  <div class="content"> 
   <div style="height: 13px;"> 
    <div onmouseover="this.style.cursor='pointer';" onclick="showElem('legend');" onmouseout="hideElem('legend')" style="height: 6px; position: absolute;" class="pre noprint docinfo bgblue" title="Click for colour legend."> 
    </div> 
    <div id="legend" class="docinfo noprint pre legend" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; " onmouseover="showElem('legend');" onmouseout="hideElem('legend');"> 
    </div> 
   </div> 
   <span class="pre noprint docinfo top">[<a href="https://tools.ietf.org/html/" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5466.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5466" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-melnikov-imapext-filters" title="draft-melnikov-imapext-filters">draft-melnikov-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc5466" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5466" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5466" title="Side-by-side diff">Diff2</a>] </span>
   <br /> 
   <span class="pre noprint docinfo"> </span>
   <br /> 
   <span class="pre noprint docinfo"> PROPOSED STANDARD</span>
   <br /> 
   <span class="pre noprint docinfo"> </span>
   <br /> 
   <pre>Network Working Group                                        A. Melnikov
Request for Comments: 5466                                       C. King
Category: Standards Track                                      Isode Ltd
                                                           February 2009


              <span class="h1"><h1>IMAP4 Extension for Named Searches (Filters)</h1></span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the &quot;Internet
   Official Protocol Standards&quot; (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/</a>
   <a href="http://trustee.ietf.org/license-info">license-info</a>) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.

Abstract

   The document defines a way to persistently store named IMAP (<a href="https://tools.ietf.org/html/rfc3501">RFC</a>
   <a href="https://tools.ietf.org/html/rfc3501">3501</a>) searches on the server.  Such named searches can be
   subsequently referenced in a SEARCH or any other command that accepts
   a search criterion as a parameter.

Table of Contents

   <a href="https://tools.ietf.org/html/rfc5466#section-1">1</a>.  Introduction and Overview . . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-2">2</a>
   <a href="https://tools.ietf.org/html/rfc5466#section-2">2</a>.  Conventions Used in This Document . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-2">2</a>
   <a href="https://tools.ietf.org/html/rfc5466#section-3">3</a>.  IMAP Protocol Changes . . . . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-2">2</a>
     <a href="https://tools.ietf.org/html/rfc5466#section-3.1">3.1</a>.  FILTER SEARCH Criterion . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-3">3</a>
     <a href="https://tools.ietf.org/html/rfc5466#section-3.2">3.2</a>.  Managing Filters Using SETMETADATA/GETMETADATA Commands . . <a href="https://tools.ietf.org/html/rfc5466#page-4">4</a>
   <a href="https://tools.ietf.org/html/rfc5466#section-4">4</a>.  Formal Syntax . . . . . . . . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-6">6</a>
   <a href="https://tools.ietf.org/html/rfc5466#section-5">5</a>.  Security Considerations . . . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-6">6</a>
   <a href="https://tools.ietf.org/html/rfc5466#section-6">6</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-7">7</a>
   <a href="https://tools.ietf.org/html/rfc5466#section-7">7</a>.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-8">8</a>
   <a href="https://tools.ietf.org/html/rfc5466#section-8">8</a>.  Normative References  . . . . . . . . . . . . . . . . . . . . . <a href="https://tools.ietf.org/html/rfc5466#page-8">8</a>





<span class="grey">Melnikov &amp; King             Standards Track                     [Page 1]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-2" id="page-2" href="https://tools.ietf.org/html/rfc5466#page-2" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


<span class="h2"><h2><a class="selflink" name="section-1" href="https://tools.ietf.org/html/rfc5466#section-1">1</a>. Introduction and Overview</h2></span>

   Persistent named searches described in this document allow clients to
   save favorite searches on the server.  Such saved searches can save
   bandwidth for clients that need to regularly repeat them.

   The FILTERS IMAP extension adds a new FILTER search criterion for
   referencing persistent named searches (a.k.a. &quot;filters&quot;), as well as
   reuses GETMETADATA/SETMETADATA commands [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>] for listing/
   creating/updating/deleting such filters.

   A filter can be private (only accessible to the logged-in user) or
   public (accessible to all logged-in users).  Both a private and a
   public filter with the same name can exist at the same time.  If both
   filter types with the same name exist, the FILTER SEARCH criterion
   (see <a href="https://tools.ietf.org/html/rfc5466#section-3.1">Section 3.1</a>) MUST use the value of the private filter;
   otherwise, it MUST use the value of the filter that exists.

   Let us call a pair of filter name and filter type a &quot;typed filter&quot;.
   Each typed filter can have a value (which is a valid IMAP SEARCH
   criteria conforming to ABNF for the &quot;search-criteria&quot; non-terminal)
   and an optional human-readable description.  The SETMETADATA command
   creates or updates the value and/or the description of a typed
   filter.

   Values of all search keys stored in a filter MUST be encoded in
   UTF-8.

<span class="h2"><h2><a class="selflink" name="section-2" href="https://tools.ietf.org/html/rfc5466#section-2">2</a>. Conventions Used in This Document</h2></span>

   In examples, &quot;C:&quot; and &quot;S:&quot; indicate lines sent by the client and
   server, respectively.  If a single &quot;C:&quot; or &quot;S:&quot; label applies to
   multiple lines, then the line breaks between those lines are for
   editorial clarity only and are not part of the actual protocol
   exchange.

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
   document are to be interpreted as described in [<a href="https://tools.ietf.org/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].

   Basic familiarity with the METADATA-SERVER extension [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>] and
   terms defined therein is required to understand this document.

<span class="h2"><h2><a class="selflink" name="section-3" href="https://tools.ietf.org/html/rfc5466#section-3">3</a>. IMAP Protocol Changes</h2></span>

   The IMAP extension for persistent named searches is present in any
   IMAP4 implementation that advertises &quot;FILTERS&quot; as one of the
   supported capabilities in the CAPABILITY response or response code.



<span class="grey">Melnikov &amp; King             Standards Track                     [Page 2]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-3" id="page-3" href="https://tools.ietf.org/html/rfc5466#page-3" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


<span class="h3"><h3><a class="selflink" name="section-3.1" href="https://tools.ietf.org/html/rfc5466#section-3.1">3.1</a>. FILTER SEARCH Criterion</h3></span>

   The FILTER criterion for the SEARCH command allows a client to
   reference by name a filter stored on the server.  Such filter was
   created by setting the server annotation named &quot;/private/filters/
   values/&lt;filter_name&gt;&quot; (or the server annotation &quot;/shared/filters/
   values/&lt;filter_name&gt;&quot;, if &quot;/private/filters/values/&lt;filter_name&gt;&quot;
   doesn't exist) using the SETMETADATA command as described in
   <a href="https://tools.ietf.org/html/rfc5466#section-3.2">Section 3.2</a>.

   Syntax: FILTER &lt;filter_name&gt;

   When the named filter exists, its search criterion (i.e., the
   associated entry value) is inserted verbatim instead of the FILTER
   search-key.  For example, the following SEARCH command

   C: a SEARCH UID 300:900 FILTER on-the-road SINCE &quot;3-Dec-2002&quot;

   would be equivalent to the following

   C: a SEARCH UID 300:900 OR SMALLER 5000 FROM &quot;boss@example.com&quot;
   SINCE &quot;3-Dec-2002&quot;

   assuming the filter &quot;on-the-road&quot; exists and contains the value 'OR
   SMALLER 5000 FROM &quot;boss@example.com&quot;'.

   A reference to a nonexistent or unaccessible (e.g., due to access
   control restrictions) filter MUST cause failure of the SEARCH command
   with the tagged NO response that includes the UNDEFINED-FILTER
   response code followed by the name of the nonexistent/unaccessible
   filter.

   Note the server SHOULD verify that each search criterion referenced
   by the FILTER search key is a full and correct search criterion.  For
   example, the server should fail the SEARCH command if its SEARCH
   criterion references a filter containing &quot;OR SMALLER&quot; search
   criterion, because this value is lacking one parameter and thus is
   not a fully specified search criterion.

   Note that a named filter itself can reference another filter using
   the FILTER search-key.  Implementations MUST be able to perform at
   least 3 substitution passes on the SEARCH command criterion.  If an
   implementation allows for more passes, it MUST implement some kind of
   loop detection.  If an implementation detects a loop or still sees a
   FILTER search-key after performing at least 3 substitutions, it MUST
   behave as if the specified filter doesn't exist (as described above).





<span class="grey">Melnikov &amp; King             Standards Track                     [Page 3]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-4" id="page-4" href="https://tools.ietf.org/html/rfc5466#page-4" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


   Note that use of the FILTER search key implies the CHARSET &quot;UTF-8&quot;
   parameter to the SEARCH/UID SEARCH command.  If the SEARCH/UID SEARCH
   command includes the explicit CHARSET parameter with the value other
   than &quot;UTF-8&quot; or &quot;US-ASCII&quot;, then such command MUST result in the
   tagged BAD response from the server.  Such tagged response MUST
   contain the BADCHARSET response code (see [<a href="https://tools.ietf.org/html/rfc3501" title="&quot;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1&quot;">RFC3501</a>]).

<span class="h3"><h3><a class="selflink" name="section-3.2" href="https://tools.ietf.org/html/rfc5466#section-3.2">3.2</a>. Managing Filters Using SETMETADATA/GETMETADATA Commands</h3></span>

   Any server compliant with this document MUST either implement the
   METADATA-SERVER (or METADATA) [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>] extension, or implement
   SETMETADATA/GETMETADATA commands described in [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>] so that they
   work for the case of empty mailbox name (i.e., for managing server
   annotations) and for the entries specified in this section.

   This document reserves two hierarchies of per-server entries under
   the &quot;/private/filters/values&quot; and &quot;/shared/filters/values&quot; roots (see
   [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>]) for storing filter values.  The value of a &quot;/private/
   filters/values/&lt;filter_name&gt;&quot; or a &quot;/shared/filters/values/
   &lt;filter_name&gt;&quot; server annotation is an IMAP SEARCH criteria,
   conforming to ABNF for the &quot;search-criteria&quot; non-terminal.  A name of
   a filter is governed by the ABNF for the &quot;filter-name&quot; non-terminal.

   Note that values of all search keys stored in these entries MUST be
   encoded in UTF-8.

   A new filter named &quot;&lt;filter_name&gt;&quot; can be created (or an existing
   filter can be modified) by storing a non-NIL value in the &quot;/private/
   filters/values/&lt;filter_name&gt;&quot; server entry (or in the &quot;/shared/
   filters/values/&lt;filter_name&gt;&quot;) using the SETMETADATA [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>]
   command.  The server SHOULD verify that each search criterion stored
   in such a server entry is a full and correct search criterion.

   A filter can be deleted by storing the NIL value in both the
   &quot;/private/filters/values/&lt;filter_name&gt;&quot; and the &quot;/shared/filters/
   values/&lt;filter_name&gt;&quot; entries.

   A filter can be renamed by first creating a filter with the new name
   (that has the same value as the old one) and then deleting the filter
   with the old one.

   If both &quot;/private/filters/values/&lt;filter_name&gt;&quot; and &quot;/shared/filters/
   values/&lt;filter_name&gt;&quot; server annotations exist, then the value of the
   &quot;/private/filters/values/&lt;filter_name&gt;&quot; is used when evaluating the
   corresponding FILTER SEARCH key (see <a href="https://tools.ietf.org/html/rfc5466#section-3.1">Section 3.1</a>).  Otherwise the
   non-NIL (existent) value is used.





<span class="grey">Melnikov &amp; King             Standards Track                     [Page 4]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-5" id="page-5" href="https://tools.ietf.org/html/rfc5466#page-5" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


   If the server is unable to create a new typed filter because the
   maximum number of allowed filters has already been reached, the
   server MUST return a tagged NO response with a &quot;[METADATA TOOMANY]&quot;
   response code, as defined in [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>].

           C: a007 SETMETADATA &quot;&quot; (&quot;/private/filters/values/on-the-road&quot;
               &quot;OR SMALLER 5000 FROM \&quot;boss@example.com\&quot;&quot;)
           S: a007 OK SETMETADATA complete

   Client implementation note: As multiple clients might read and write
   filter values, it is possible that one client will use a SEARCH key
   that might not be recognized by another client that tries to present
   a user interface for editing a filter value.  In order to help other
   clients to (partially) parse filter values for editing purposes, a
   client storing a filter value SHOULD use () around any SEARCH key not
   defined in [<a href="https://tools.ietf.org/html/rfc3501" title="&quot;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1&quot;">RFC3501</a>].  For example, if there is an IMAP extension
   that defines a new x-dsfa SEARCH key that takes 2 parameters, then
   the following SEARCH criterion 'from &quot;@example.com&gt;&quot; x-dsfa from 5'
   should be stored as 'from &quot;@example.com&gt;&quot; (x-dsfa from 5)'.

   Note that filter names are restricted to a subset of US-ASCII, as
   described in <a href="https://tools.ietf.org/html/rfc5466#section-4">Section 4</a>.  So they might not always be meaningful to
   users and thus not necessarily suitable for display purposes.  In
   order to help with storing human-readable descriptions of filters,
   this document also reserves two hierarchies of server entries under
   the &quot;/private/filters/descriptions&quot; and &quot;/shared/filters/
   descriptions&quot; roots.  The value of a &quot;/private/filters/descriptions/
   &lt;filter_name&gt;&quot; or a &quot;/shared/filters/descriptions/&lt;filter_name&gt;&quot;
   server annotation is a human-readable description for the
   &lt;filter_name&gt; filter, encoded in UTF-8 [<a href="https://tools.ietf.org/html/rfc5466#ref-UTF-8" title="&quot;UTF-8, a transformation format of ISO 10646&quot;">UTF-8</a>].  If the &quot;/private/
   filters/descriptions/&lt;filter_name&gt;&quot; server annotation exists, its
   value is used by the client as the filter description.  Otherwise,
   the value of the &quot;/shared/filters/descriptions/&lt;filter_name&gt;&quot; server
   annotation is used as the filter description.  In the absence of both
   the &quot;/private/filters/descriptions/&lt;filter_name&gt;&quot; and the &quot;/shared/
   filters/descriptions/&lt;filter_name&gt;&quot; entries, the client MAY display
   the name of the filter as its description.

   The description string SHOULD be annotated with one or more language
   tags [<a href="https://tools.ietf.org/html/rfc4646" title="&quot;Tags for Identifying Languages&quot;">RFC4646</a>] as specified in Chapter 16.9 of [<a href="https://tools.ietf.org/html/rfc5466#ref-Unicode" title="&quot;The Unicode Standard 5.0&quot;">Unicode</a>].  In the
   absence of any language tag, the &quot;i-default&quot; [<a href="https://tools.ietf.org/html/rfc2277" title="&quot;IETF Policy on Character Sets and Languages&quot;">RFC2277</a>] language
   SHOULD be assumed.  Description in multiple languages MAY be present
   in a single description string.  This is done by concatenating
   descriptions in multiple languages into a single string, each
   description prefixed with its language tag, for example
   &quot;&lt;ru&gt;&lt;...description in Russian...&gt;&lt;fr-ca&gt;&lt;...description in
   French...&gt;&quot;.  Note that here &lt;ru&gt; is a language tag consisting of 3
   Unicode characters: &lt;U+E0001&gt;, &lt;U+E0072&gt;, &lt;U+E0075&gt;; and &lt;fr-ca&gt; is a



<span class="grey">Melnikov &amp; King             Standards Track                     [Page 5]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-6" id="page-6" href="https://tools.ietf.org/html/rfc5466#page-6" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


   language tag consisting of 6 Unicode characters: &lt;U+E0001&gt;,
   &lt;U+E0066&gt;, &lt;U+E0072&gt;, &lt;U+E002D&gt;, &lt;U+E0063&gt;, &lt;U+E0061&gt;.

<span class="h2"><h2><a class="selflink" name="section-4" href="https://tools.ietf.org/html/rfc5466#section-4">4</a>. Formal Syntax</h2></span>

   The following syntax specification uses the Augmented Backus-Naur
   Form (ABNF) notation as specified in [<a href="https://tools.ietf.org/html/rfc5466#ref-ABNF" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">ABNF</a>].

   Non-terminals referenced but not defined below are as defined by
   [<a href="https://tools.ietf.org/html/rfc3501" title="&quot;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1&quot;">RFC3501</a>] or [<a href="https://tools.ietf.org/html/rfc5466#ref-IMAPABNF" title="&quot;Collected Extensions to IMAP4 ABNF&quot;">IMAPABNF</a>].

   Except as noted otherwise, all alphabetic characters are case-
   insensitive.  The use of upper or lower case characters to define
   token strings is for editorial clarity only.  Implementations MUST
   accept these strings in a case-insensitive fashion.

   capability            =/ &quot;FILTERS&quot;

   search-criteria       =  search-key *(SP search-key)

   search-key            =/  &quot;FILTER&quot; SP filter-name
                         ;; New SEARCH criterion for referencing filters

   filter-name           =  1*&lt;any ATOM-CHAR except &quot;/&quot;&gt;
                         ;; Note that filter-name disallows UTF-8 or
                         ;; the following characters: &quot;(&quot;, &quot;)&quot;, &quot;{&quot;,
                         ;; &quot; &quot;, &quot;%&quot;, &quot;*&quot;, &quot;]&quot;.  See definition of
                         ;; ATOM-CHAR [<a href="https://tools.ietf.org/html/rfc3501" title="&quot;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1&quot;">RFC3501</a>].

   resp-text-code        =/  &quot;UNDEFINED-FILTER&quot; SP filter-name

<span class="h2"><h2><a class="selflink" name="section-5" href="https://tools.ietf.org/html/rfc5466#section-5">5</a>. Security Considerations</h2></span>

   General issues relevant to [<a href="https://tools.ietf.org/html/rfc3501" title="&quot;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1&quot;">RFC3501</a>] (in particular to the SEARCH
   command) and METADATA-SERVER extension [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>] are also relevant
   to this document.

   Note that excessive use of filters can potentially simplify denial-
   of-service attacks, especially if combined with poor implementations
   and lack of loop detection (i.e., detection of filters referencing
   each other to create a loop).  Servers that allow for anonymous
   access SHOULD NOT allow anonymous users to create/edit/delete
   filters.

   Also note that stored filters can potentially disclose personal
   information about users.  When confidentiality of such information is
   important, clients MUST use TLS and/or SASL security layer (or
   similar) as recommended in [<a href="https://tools.ietf.org/html/rfc3501" title="&quot;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1&quot;">RFC3501</a>].  Also, clients should use



<span class="grey">Melnikov &amp; King             Standards Track                     [Page 6]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-7" id="page-7" href="https://tools.ietf.org/html/rfc5466#page-7" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


   private filters instead of public, unless they desire to share such
   information with other users.

   As always, it is important to thoroughly test clients and servers
   when implementing this extension.

<span class="h2"><h2><a class="selflink" name="section-6" href="https://tools.ietf.org/html/rfc5466#section-6">6</a>. IANA Considerations</h2></span>

   IMAP4 capabilities are registered by publishing a Standards Track or
   IESG-approved Experimental RFC.  The IMAP4 capabilities registry is
   available from <a href="http://www.iana.org">http://www.iana.org</a>.

   This document defines the FILTERS IMAP capability.  IANA has added it
   to the registry.

   IANA has added the following 4 entries to the [<a href="https://tools.ietf.org/html/rfc5466#ref-METADATA" title="&quot;The IMAP METADATA Extension&quot;">METADATA</a>] registry:

   To:  iana@iana.org
   Subject:  IMAP METADATA Entry Registration
   Type:  Server
   Name:  /private/filters/values/&lt;filter_name&gt;
   Description:  Contains an IMAP SEARCH criteria.  Defined in <a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>.
   Content-type:  text/plain; charset=utf-8
   Contact person:  Alexey Melnikov
   Email:  alexey.melnikov@isode.com

   To:  iana@iana.org
   Subject:  IMAP METADATA Entry Registration
   Type:  Server
   Name:  /shared/filters/values/&lt;filter_name&gt;
   Description:  Contains an IMAP SEARCH criterion.  Defined in <a href="https://tools.ietf.org/html/rfc5466">RFC</a>
      <a href="https://tools.ietf.org/html/rfc5466">5466</a>.
   Content-type:  text/plain; charset=utf-8
   Contact person:  Alexey Melnikov
   Email:  alexey.melnikov@isode.com

   To:  iana@iana.org
   Subject:  IMAP METADATA Entry Registration
   Type:  Server
   Name:  /private/filters/descriptions/&lt;filter_name&gt;
   Description:  Contains a user-specific human-readable description of
      a named SEARCH criterion stored in the /private/filters/values/
      &lt;filter_name&gt; or /shared/filters/values/&lt;filter_name&gt; annotation.
      The value is in UTF-8.  Defined in <a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>.
   Content-type:  text/plain; charset=utf-8
   Contact person:  Alexey Melnikov
   Email:  alexey.melnikov@isode.com




<span class="grey">Melnikov &amp; King             Standards Track                     [Page 7]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-8" id="page-8" href="https://tools.ietf.org/html/rfc5466#page-8" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


   To:  iana@iana.org
   Subject:  IMAP METADATA Entry Registration
   Type:  Server
   Name:  /shared/filters/descriptions/&lt;filter_name&gt;
   Description:  Contains a global (shared among all users) human-
      readable description of a named SEARCH criterion stored in the
      /private/filters/values/&lt;filter_name&gt; or /shared/filters/values/
      &lt;filter_name&gt; annotation.  The value is in UTF-8.  Defined in <a href="https://tools.ietf.org/html/rfc5466">RFC</a>
      <a href="https://tools.ietf.org/html/rfc5466">5466</a>.
   Content-type:  text/plain; charset=utf-8
   Contact person:  Alexey Melnikov
   Email:  alexey.melnikov@isode.com

<span class="h2"><h2><a class="selflink" name="section-7" href="https://tools.ietf.org/html/rfc5466#section-7">7</a>. Acknowledgments</h2></span>

   Thanks to David Cridland, Arnt Gulbrandsen, Chris Newman, and Timo
   Sirainen for comments and suggestions on this document.  Special
   thank you to Brian E. Carpenter for the GenArt review.

<span class="h2"><h2><a class="selflink" name="section-8" href="https://tools.ietf.org/html/rfc5466#section-8">8</a>. Normative References</h2></span>

   [<a name="ref-ABNF" id="ref-ABNF">ABNF</a>]      Crocker, D., Ed. and P. Overell, Ed., &quot;Augmented BNF for
               Syntax Specifications: ABNF&quot;, STD 68, <a href="https://tools.ietf.org/html/rfc5234">RFC 5234</a>,
               January 2008.

   [<a name="ref-IMAPABNF" id="ref-IMAPABNF">IMAPABNF</a>]  Melnikov, A. and C. Daboo, &quot;Collected Extensions to IMAP4
               ABNF&quot;, <a href="https://tools.ietf.org/html/rfc4466">RFC 4466</a>, April 2006.

   [<a name="ref-METADATA" id="ref-METADATA">METADATA</a>]  Daboo, C., &quot;The IMAP METADATA Extension&quot;, <a href="https://tools.ietf.org/html/rfc5464">RFC 5464</a>,
               February 2009.

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]   Bradner, S., &quot;Key words for use in RFCs to Indicate
               Requirement Levels&quot;, <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a>, March 1997.

   [<a name="ref-RFC2277" id="ref-RFC2277">RFC2277</a>]   Alvestrand, H., &quot;IETF Policy on Character Sets and
               Languages&quot;, <a href="https://tools.ietf.org/html/bcp18">BCP 18</a>, <a href="https://tools.ietf.org/html/rfc2277">RFC 2277</a>, January 1998.

   [<a name="ref-RFC3501" id="ref-RFC3501">RFC3501</a>]   Crispin, M., &quot;INTERNET MESSAGE ACCESS PROTOCOL - VERSION
               4rev1&quot;, <a href="https://tools.ietf.org/html/rfc3501">RFC 3501</a>, March 2003.

   [<a name="ref-RFC4646" id="ref-RFC4646">RFC4646</a>]   Phillips, A. and M. Davis, &quot;Tags for Identifying
               Languages&quot;, <a href="https://tools.ietf.org/html/bcp47">BCP 47</a>, <a href="https://tools.ietf.org/html/rfc4646">RFC 4646</a>, September 2006.

   [<a name="ref-UTF-8" id="ref-UTF-8">UTF-8</a>]     Yergeau, F., &quot;UTF-8, a transformation format of ISO
               10646&quot;, STD 63, <a href="https://tools.ietf.org/html/rfc3629">RFC 3629</a>, November 2003.

   [<a name="ref-Unicode" id="ref-Unicode">Unicode</a>]   &quot;The Unicode Standard 5.0&quot;, Unicode 5.0, 2007,
               &lt;<a href="http://www.unicode.org/versions/Unicode5.0.0/">http://www.unicode.org/versions/Unicode5.0.0/</a>&gt;.



<span class="grey">Melnikov &amp; King             Standards Track                     [Page 8]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-9" id="page-9" href="https://tools.ietf.org/html/rfc5466#page-9" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc5466">RFC 5466</a>                      IMAP Filters                 February 2009</span>


Authors' Addresses

   Alexey Melnikov
   Isode Ltd
   5 Castle Business Village
   36 Station Road
   Hampton, Middlesex  TW12 2BX
   UK

   EMail: Alexey.Melnikov@isode.com


   Curtis King
   Isode Ltd
   5 Castle Business Village
   36 Station Road
   Hampton, Middlesex  TW12 2BX
   UK

   EMail: Curtis.King@isode.com































Melnikov &amp; King             Standards Track                     [Page 9]

</pre>
   <br /> 
   <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.127, available from <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a> </small></small></span> 
  </div> 
 </body>
</html>