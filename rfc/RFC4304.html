<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head profile="http://dublincore.org/documents/2008/08/04/dc-html/"> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta name="robots" content="index,follow" /> 
  <meta name="creator" content="rfcmarkup version 1.127" /> 
  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" /> 
  <meta name="DC.Identifier" content="urn:ietf:rfc:4304" /> 
  <meta name="DC.Description.Abstract" content="The IP Security Authentication Header (AH) and Encapsulating Security
Payload (ESP) protocols use a sequence number to detect replay. This
document describes extensions to the Internet IP Security Domain of
Interpretation (DOI) for the Internet Security Association and Key
Management Protocol (ISAKMP). These extensions support negotiation of
the use of traditional 32-bit sequence numbers or extended (64-bit)
sequence numbers (ESNs) for a particular AH or ESP security
association. [STANDARDS-TRACK]" /> 
  <meta name="DC.Creator" content="Stephen Kent &lt;kent@bbn.com&gt;" /> 
  <meta name="DC.Date.Issued" content="December, 2005" /> 
  <meta name="DC.Title" content="Extended Sequence Number (ESN) Addendum to IPsec Domain of Interpretation (DOI) for Internet Security Association and Key Management Protocol (ISAKMP)" /> 
  <link rel="icon" href="/images/rfc.png" type="image/png" /> 
  <link rel="shortcut icon" href="/images/rfc.png" type="image/png" /> 
  <title>RFC 4304 - Extended Sequence Number (ESN) Addendum to IPsec Domain of Interpretation (DOI) for Internet Security Association and Key Management Protocol (ISAKMP)</title> 
  <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style> 
  <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]--> 
  <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script> 
 </head> 
 <body onload="addHeaderTags()"> 
  <div class="content"> 
   <div style="height: 13px;"> 
    <div onmouseover="this.style.cursor='pointer';" onclick="showElem('legend');" onmouseout="hideElem('legend')" style="height: 6px; position: absolute;" class="pre noprint docinfo bgblue" title="Click for colour legend."> 
    </div> 
    <div id="legend" class="docinfo noprint pre legend" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; " onmouseover="showElem('legend');" onmouseout="hideElem('legend');"> 
    </div> 
   </div> 
   <span class="pre noprint docinfo top">[<a href="https://tools.ietf.org/html/" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc4304.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc4304" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-ipsec-esn-addendum" title="draft-ietf-ipsec-esn-addendum">draft-ietf-ipse...</a>] [<a href="https://datatracker.ietf.org/doc/rfc4304" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc4304" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc4304" title="Side-by-side diff">Diff2</a>] </span>
   <br /> 
   <span class="pre noprint docinfo"> </span>
   <br /> 
   <span class="pre noprint docinfo"> PROPOSED STANDARD</span>
   <br /> 
   <span class="pre noprint docinfo"> </span>
   <br /> 
   <pre>Network Working Group                                            S. Kent
Request for Comments: 4304                              BBN Technologies
Category: Standards Track                                  December 2005


              <span class="h1"><h1>Extended Sequence Number (ESN) Addendum to</h1></span>
                  <span class="h1"><h1>IPsec Domain of Interpretation (DOI)</h1></span>
                   <span class="h1"><h1>for Internet Security Association</h1></span>
                  and Key Management Protocol (ISAKMP)

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the &quot;Internet
   Official Protocol Standards&quot; (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2005).

Abstract

   The IP Security Authentication Header (AH) and Encapsulating Security
   Payload (ESP) protocols use a sequence number to detect replay.  This
   document describes extensions to the Internet IP Security Domain of
   Interpretation (DOI) for the Internet Security Association and Key
   Management Protocol (ISAKMP).  These extensions support negotiation
   of the use of traditional 32-bit sequence numbers or extended (64-
   bit) sequence numbers (ESNs) for a particular AH or ESP security
   association.



















<span class="grey">Kent                        Standards Track                     [Page 1]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-2" id="page-2" href="https://tools.ietf.org/html/rfc4304#page-2" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc4304">RFC 4304</a>               ESN Addendum to ISAKMP DOI          December 2005</span>


<span class="h2"><h2><a class="selflink" name="section-1" href="https://tools.ietf.org/html/rfc4304#section-1">1</a>. Introduction</h2></span>

   The specifications for the IP Authentication Header (AH) [<a href="https://tools.ietf.org/html/rfc4304#ref-AH" title="&quot;IP Authentication Header&quot;">AH</a>] and the
   IP Encapsulating Security Payload (ESP) [<a href="https://tools.ietf.org/html/rfc4304#ref-ESP" title="&quot;IP Encapsulating Security Payload (ESP)&quot;">ESP</a>] describe an option for
   use of extended (64-bit) sequence numbers.  This option permits
   transmission of very large volumes of data at high speeds over an
   IPsec Security Association, without rekeying to avoid sequence number
   space exhaustion.  This document describes the additions to the IPsec
   DOI for ISAKMP [<a href="https://tools.ietf.org/html/rfc4304#ref-DOI" title="&quot;The Internet IP Security Domain of Interpretation for ISAKMP&quot;">DOI</a>] that are needed to support negotiation of the
   extended sequence number (ESN) option.

   The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD,
   SHOULD NOT, RECOMMENDED, MAY, and OPTIONAL, when they appear in this
   document, are to be interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a> [<a href="https://tools.ietf.org/html/rfc4304#ref-Bra97" title="&quot;Key words for use in RFCs to Indicate Requirement Level&quot;">Bra97</a>].

<span class="h2"><h2><a class="selflink" name="section-2" href="https://tools.ietf.org/html/rfc4304#section-2">2</a>. IPsec Security Association Attribute</h2></span>

   The following SA attribute definition is used in Phase II of an
   Internet Key Exchange Protocol (IKE) negotiation.  The attribute type
   is Basic (B).  Encoding of this attribute is defined in the base
   ISAKMP specification [<a href="https://tools.ietf.org/html/rfc4304#ref-ISAKMP" title="&quot;Internet Security Association and Key Management Protocol (ISAKMP)&quot;">ISAKMP</a>].  Attributes described as basic MUST
   NOT be encoded as variable.  See [<a href="https://tools.ietf.org/html/rfc4304#ref-IKE" title="&quot;The Internet Key Exchange (IKE)&quot;">IKE</a>] for further information on
   attribute encoding in the IPsec DOI.  All restrictions listed in
   [<a href="https://tools.ietf.org/html/rfc4304#ref-IKE" title="&quot;The Internet Key Exchange (IKE)&quot;">IKE</a>] also apply to the IPsec DOI and to this addendum.

   Attribute Type

              class                        value           type
       ---------------------------------------------------------
       Extended (64-bit) Sequence Number    11              B

   Class Values

       This class specifies that the Security Association will be using
       64-bit sequence numbers.  (See [<a href="https://tools.ietf.org/html/rfc4304#ref-AH" title="&quot;IP Authentication Header&quot;">AH</a>] and [<a href="https://tools.ietf.org/html/rfc4304#ref-ESP" title="&quot;IP Encapsulating Security Payload (ESP)&quot;">ESP</a>] for a description
       of extended (64-bit) sequence numbers.)

       RESERVED                0
       64-bit Sequence Number  1












<span class="grey">Kent                        Standards Track                     [Page 2]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-3" id="page-3" href="https://tools.ietf.org/html/rfc4304#page-3" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc4304">RFC 4304</a>               ESN Addendum to ISAKMP DOI          December 2005</span>


<span class="h2"><h2><a class="selflink" name="section-3" href="https://tools.ietf.org/html/rfc4304#section-3">3</a>. Attribute Negotiation</h2></span>

   If an implementation receives a defined IPsec DOI attribute (or
   attribute value) that it does not support, an ATTRIBUTES-NOT-SUPPORT
   SHOULD be sent and the security association setup MUST be aborted.

   If an implementation receives any attribute value but the value for
   64-bit sequence numbers, the security association setup MUST be
   aborted.

<span class="h2"><h2><a class="selflink" name="section-4" href="https://tools.ietf.org/html/rfc4304#section-4">4</a>. Security Considerations</h2></span>

   This memo pertains to the Internet Key Exchange protocol [<a href="https://tools.ietf.org/html/rfc4304#ref-IKE" title="&quot;The Internet Key Exchange (IKE)&quot;">IKE</a>], which
   combines ISAKMP [<a href="https://tools.ietf.org/html/rfc4304#ref-ISAKMP" title="&quot;Internet Security Association and Key Management Protocol (ISAKMP)&quot;">ISAKMP</a>] and Oakley [<a href="https://tools.ietf.org/html/rfc4304#ref-OAKLEY" title="&quot;The OAKLEY Key Determination Protocol&quot;">OAKLEY</a>] to provide for the
   derivation of cryptographic keying material in a secure and
   authenticated manner.  Specific discussion of the various security
   protocols and transforms identified in this document can be found in
   the associated base documents and in the cipher references.

   The addition of the ESN attribute does not change the underlying
   security characteristics of IKE.  In using ESNs with ESP, it is
   important to employ an encryption mode that is secure when very large
   volumes of data are encrypted under a single key.  Thus, for example,
   Data Encryption Standard (DES) in Cipher Block Chaining (CBC) mode
   would NOT be suitable for use with the ESN, because no more than 2^32
   blocks should be encrypted under a single DES key in that mode.
   Similarly, the integrity algorithm used with ESP or AH should be
   secure relative to the number of packets being protected.  To avoid
   potential security problems imposed by algorithm limitations, the SA
   lifetime may be set to limit the volume of data protected with a
   single key, prior to reaching the 2^64 packet limit imposed by the
   ESN.

<span class="h2"><h2><a class="selflink" name="section-5" href="https://tools.ietf.org/html/rfc4304#section-5">5</a>. IANA Considerations</h2></span>

   This document contains a &quot;magic&quot; number to be maintained by the IANA.
   No additional class values will be assigned for this attribute.  The
   IANA has allocated an IPsec Security Attribute value for &quot;Attribute
   Type&quot;.  This value is listed under the heading &quot;value&quot; in the table
   in <a href="https://tools.ietf.org/html/rfc4304#section-2">Section 2</a>.

Acknowledgements

   The author would like to thank the members of the IPsec working
   group.  The author would also like to acknowledge the contributions
   of Karen Seo for her help in the editing of this specification.





<span class="grey">Kent                        Standards Track                     [Page 3]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-4" id="page-4" href="https://tools.ietf.org/html/rfc4304#page-4" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc4304">RFC 4304</a>               ESN Addendum to ISAKMP DOI          December 2005</span>


Normative References

   [<a name="ref-Bra97" id="ref-Bra97">Bra97</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate
            Requirement Level&quot;, <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a>, March 1997.

   [<a name="ref-AH" id="ref-AH">AH</a>]     Kent, S., &quot;IP Authentication Header&quot;, <a href="https://tools.ietf.org/html/rfc4302">RFC 4302</a>, December
            2005.

   [<a name="ref-DOI" id="ref-DOI">DOI</a>]    Piper, D., &quot;The Internet IP Security Domain of
            Interpretation for ISAKMP&quot;, <a href="https://tools.ietf.org/html/rfc2407">RFC 2407</a>, November 1998.

   [<a name="ref-ESP" id="ref-ESP">ESP</a>]    Kent, S., &quot;IP Encapsulating Security Payload (ESP)&quot;, <a href="https://tools.ietf.org/html/rfc4303">RFC</a>
            <a href="https://tools.ietf.org/html/rfc4303">4303</a>, December 2005.

   [<a name="ref-IKE" id="ref-IKE">IKE</a>]    Harkins, D. and D. Carrel, &quot;The Internet Key Exchange
            (IKE)&quot;, <a href="https://tools.ietf.org/html/rfc2409">RFC 2409</a>, November 1998.

   [<a name="ref-ISAKMP" id="ref-ISAKMP">ISAKMP</a>] Maughan, D., Schertler, M., Schneider, M., and J. Turner,
            &quot;Internet Security Association and Key Management Protocol
            (ISAKMP)&quot;, <a href="https://tools.ietf.org/html/rfc2408">RFC 2408</a>, November 1998.

Informative References

   [<a name="ref-OAKLEY" id="ref-OAKLEY">OAKLEY</a>] Orman, H., &quot;The OAKLEY Key Determination Protocol&quot;, <a href="https://tools.ietf.org/html/rfc2412">RFC</a>
            <a href="https://tools.ietf.org/html/rfc2412">2412</a>, November 1998.

Author's Address

   Stephen Kent
   BBN Technologies
   10 Moulton Street
   Cambridge, MA  02138
   USA

   Phone: +1 (617) 873-3988
   EMail: kent@bbn.com















<span class="grey">Kent                        Standards Track                     [Page 4]</span></pre> 
   <hr class="noprint" style="width: 96ex;" align="left" />
   <!--NewPage-->
   <pre class="newpage"><a name="page-5" id="page-5" href="https://tools.ietf.org/html/rfc4304#page-5" class="invisible"> </a>
<span class="grey"><a href="https://tools.ietf.org/html/rfc4304">RFC 4304</a>               ESN Addendum to ISAKMP DOI          December 2005</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2005).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   &quot;AS IS&quot; basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at ietf-
   ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.







Kent                        Standards Track                     [Page 5]

</pre>
   <br /> 
   <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.127, available from <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a> </small></small></span> 
  </div> 
 </body>
</html>